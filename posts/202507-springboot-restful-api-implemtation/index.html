<!doctype html><html lang=tw><head><title>èª²ç¨‹ç­†è¨˜ Spring Boot èˆ‡ Spring Security å¯¦ä½œ RESTful API :: kinako890419</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Part 0: å¤§ç¶± å°ˆæ¡ˆç›®æ¨™ å»ºç«‹ä¸€å€‹å®¶åº­é›¶ç”¨éŒ¢ç®¡ç†æ‡‰ç”¨ï¼š
åˆ©ç”¨ Spring Boot å‰µå»º RESTful API èˆ‡ç¶²é æ‡‰ç”¨ Spring Data, Spring Security åˆæ¢ å°ˆæ¡ˆå°å‘çš„èª²ç¨‹ Test-First é–‹ç™¼æ–¹æ³•: é€šå¸¸æœƒåœ¨å¯¦ä½œä¹‹å‰ç·¨å¯«æ¸¬è©¦ å…§å®¹ç¸½è¦½ RESTful API åŸºç¤è¨­è¨ˆåŸå‰‡ æ¸¬è©¦å°å‘é–‹ç™¼ï¼ˆTDDï¼‰ ä½¿ç”¨ Spring Boot é–‹ç™¼ RESTfulAPI Spring Security æ‡‰ç”¨ å®‰å…¨æ€§æ©Ÿåˆ¶èˆ‡é¢¨éšªé˜²è­· "><meta name=keywords content="Spring Boot èª²ç¨‹ç­†è¨˜,Spring Academy ç­†è¨˜"><meta name=robots content="noodp"><meta name=google-site-verification content="lr5h4speGPgLu9Px91dSXi0VOcHNyEwf5nhnJVYNUMo"><link rel=canonical href=https://kinako890419.github.io/blog/posts/202507-springboot-restful-api-implemtation/><link rel=stylesheet href=https://kinako890419.github.io/blog/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/main.min.775ac2af004d44c22a6d000fbd1d9af529642f5cef27399d0280d180af2c2e9b.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/menu.min.310d32205bdedd6f43144e3c3273c9deecd238eba5f9108db5ea96ca0cfbe377.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/post.min.ad50c7f4d00e7975918f37fc74c6029e1959a40d66fb5b2c6564a8715e985573.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/syntax.min.e9ab635cf918bc84b901eb65c0b2caa74c9544245e3647c1af5c129896ef276e.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/terminal.min.4cacd2346817eaed5e2ca0fa96fb1a9e9d544953eaf573b95dc602785bd8c033.css><link rel=stylesheet href=https://kinako890419.github.io/blog/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel="shortcut icon" href=https://kinako890419.github.io/blog/favicon.png><link rel=apple-touch-icon href=https://kinako890419.github.io/blog/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="tw"><meta property="og:type" content="article"><meta property="og:title" content="èª²ç¨‹ç­†è¨˜ Spring Boot èˆ‡ Spring Security å¯¦ä½œ RESTful API"><meta property="og:description" content="Part 0: å¤§ç¶± å°ˆæ¡ˆç›®æ¨™ å»ºç«‹ä¸€å€‹å®¶åº­é›¶ç”¨éŒ¢ç®¡ç†æ‡‰ç”¨ï¼š
åˆ©ç”¨ Spring Boot å‰µå»º RESTful API èˆ‡ç¶²é æ‡‰ç”¨ Spring Data, Spring Security åˆæ¢ å°ˆæ¡ˆå°å‘çš„èª²ç¨‹ Test-First é–‹ç™¼æ–¹æ³•: é€šå¸¸æœƒåœ¨å¯¦ä½œä¹‹å‰ç·¨å¯«æ¸¬è©¦ å…§å®¹ç¸½è¦½ RESTful API åŸºç¤è¨­è¨ˆåŸå‰‡ æ¸¬è©¦å°å‘é–‹ç™¼ï¼ˆTDDï¼‰ ä½¿ç”¨ Spring Boot é–‹ç™¼ RESTfulAPI Spring Security æ‡‰ç”¨ å®‰å…¨æ€§æ©Ÿåˆ¶èˆ‡é¢¨éšªé˜²è­· "><meta property="og:url" content="https://kinako890419.github.io/blog/posts/202507-springboot-restful-api-implemtation/"><meta property="og:site_name" content="kinako890419"><meta property="og:image" content="https://kinako890419.github.io/blog/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2025-07-04 00:00:00 +0800 +0800"></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/blog/tags/homepage/><div class=logo>kinako890419é‡Œæ°‘æ´»å‹•ä¸­å¿ƒ</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;â–¾</li><li><ul class=menu__dropdown><li><a href=/blog/>Home</a></li><li><a href=/blog/posts>Posts</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/blog/>Home</a></li><li><a href=/blog/posts>Posts</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://kinako890419.github.io/blog/posts/202507-springboot-restful-api-implemtation/>èª²ç¨‹ç­†è¨˜ Spring Boot èˆ‡ Spring Security å¯¦ä½œ RESTful API</a></h1><div class=post-meta><time class=post-date>2025-07-04</time><span class=post-reading-time>12 min read (2523 words)</span></div><span class=post-tags>#<a href=https://kinako890419.github.io/blog/tags/%E8%AA%B2%E7%A8%8B%E7%AD%86%E8%A8%98/>èª²ç¨‹ç­†è¨˜</a>&nbsp;
#<a href=https://kinako890419.github.io/blog/tags/springacademy/>SpringAcademy</a>&nbsp;
#<a href=https://kinako890419.github.io/blog/tags/springboot/>SpringBoot</a>&nbsp;</span><div class=post-content><div><h1 id=part-0-å¤§ç¶±>Part 0: å¤§ç¶±<a href=#part-0-å¤§ç¶± class=hanchor arialabel=Anchor>#</a></h1><h2 id=å°ˆæ¡ˆç›®æ¨™>å°ˆæ¡ˆç›®æ¨™<a href=#å°ˆæ¡ˆç›®æ¨™ class=hanchor arialabel=Anchor>#</a></h2><p>å»ºç«‹ä¸€å€‹å®¶åº­é›¶ç”¨éŒ¢ç®¡ç†æ‡‰ç”¨ï¼š</p><ul><li>åˆ©ç”¨ Spring Boot å‰µå»º <strong>RESTful API</strong> èˆ‡ç¶²é æ‡‰ç”¨</li><li>Spring Data, Spring Security åˆæ¢</li><li>å°ˆæ¡ˆå°å‘çš„èª²ç¨‹</li><li>Test-First é–‹ç™¼æ–¹æ³•: é€šå¸¸æœƒåœ¨å¯¦ä½œä¹‹å‰ç·¨å¯«æ¸¬è©¦</li></ul><h2 id=å…§å®¹ç¸½è¦½>å…§å®¹ç¸½è¦½<a href=#å…§å®¹ç¸½è¦½ class=hanchor arialabel=Anchor>#</a></h2><ol><li>RESTful API åŸºç¤è¨­è¨ˆåŸå‰‡</li><li>æ¸¬è©¦å°å‘é–‹ç™¼ï¼ˆTDDï¼‰</li><li>ä½¿ç”¨ Spring Boot é–‹ç™¼ RESTfulAPI</li><li>Spring Security æ‡‰ç”¨</li><li>å®‰å…¨æ€§æ©Ÿåˆ¶èˆ‡é¢¨éšªé˜²è­·</li></ol><h2 id=æª”æ¡ˆæ¶æ§‹>æª”æ¡ˆæ¶æ§‹<a href=#æª”æ¡ˆæ¶æ§‹ class=hanchor arialabel=Anchor>#</a></h2><pre tabindex=0><code>ğŸ“¦ src
â”œâ”€â”€ ğŸ“ main
â”‚   â”œâ”€â”€ ğŸ“ java
â”‚   â”‚   â””â”€â”€ ğŸ“ com.springacademy.cashcard
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ CashCard.java             // è³‡æ–™ Entityï¼šä»£è¡¨ä¸€ç­† CashCardsï¼ŒåŒ…å« idã€amountã€owner
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ CashcardApplication.java  // æ‡‰ç”¨å•Ÿå‹•å…¥å£ï¼ˆSpring Boot main classï¼‰
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ CashCardController.java   // è² è²¬æ¥æ”¶ REST API è«‹æ±‚ï¼Œå›å‚³ HTTP å›æ‡‰ï¼ˆGET/POST/PUT/DELETEï¼‰
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ CashCardRepository.java   // è³‡æ–™å­˜å–ä»‹é¢ï¼šç¹¼æ‰¿è‡ª `CrudRepository` å’Œ `PagingAndSortingRepository`ï¼Œæä¾›è³‡æ–™åº« CRUD åŠŸèƒ½
â”‚   â”‚       â””â”€â”€ ğŸ“„ SecurityConfig.java       // Spring Security å®‰å…¨æ€§è¨­å®šï¼šè§’è‰²æ¬Šé™ã€é–‹å•Ÿ/é—œé–‰ CSRFã€HTTP Basic èªè­‰
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ resources
â”‚       â”œâ”€â”€ ğŸ“ static
â”‚       â”œâ”€â”€ ğŸ“ templates
â”‚       â”œâ”€â”€ ğŸ“„ application.properties
â”‚       â””â”€â”€ ğŸ“„ schema.sql                    // å°ˆæ¡ˆå•Ÿå‹•æ™‚æœƒè‡ªå‹•åŸ·è¡Œï¼Œç”¨ä¾†å»ºç«‹ `CASH_CARD` è³‡æ–™è¡¨
â”‚
â”œâ”€â”€ ğŸ“ test
â”‚   â”œâ”€â”€ ğŸ“ java
â”‚   â”‚   â””â”€â”€ ğŸ“ com.springacademy.cashcard
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ CashCardApplicationTests.java // é©—è­‰ API è¡Œç‚ºæ­£ç¢ºæ€§
â”‚   â”‚       â””â”€â”€ ğŸ“„ CashCardJsonTest.java         // JSON æ¸¬è©¦ï¼šç¢ºèªåºåˆ—åŒ–èˆ‡ååºåˆ—åŒ–æ˜¯å¦æ­£ç¢º
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ resources
â”‚       â”œâ”€â”€ ğŸ“ com.springacademy.cashcard
â”‚       â”‚   â”œâ”€â”€ ğŸ“„ expected.json             // å–®ç­†è³‡æ–™çš„é æœŸ JSON æ ¼å¼ï¼ˆfor JSON æ¸¬è©¦ï¼‰
â”‚       â”‚   â””â”€â”€ ğŸ“„ list.json                 // å¤šç­†è³‡æ–™çš„é æœŸ JSON æ ¼å¼ï¼ˆfor JSON æ¸¬è©¦ï¼‰
â”‚       â””â”€â”€ ğŸ“„ data.sql                      // æ¸¬è©¦è³‡æ–™ SQLï¼šåœ¨æ¸¬è©¦åŸ·è¡Œå‰åŒ¯å…¥è³‡æ–™
</code></pre><hr><h1 id=part1-spring-boot-é–‹ç™¼-restful-api-èˆ‡-tdd-åˆæ¢>Part1: Spring Boot é–‹ç™¼ Restful API èˆ‡ TDD åˆæ¢<a href=#part1-spring-boot-é–‹ç™¼-restful-api-èˆ‡-tdd-åˆæ¢ class=hanchor arialabel=Anchor>#</a></h1><h2 id=idempotenceå†ªç­‰æ€§-and-http>Idempotenceï¼ˆå†ªç­‰æ€§ï¼‰ and HTTP<a href=#idempotenceå†ªç­‰æ€§-and-http class=hanchor arialabel=Anchor>#</a></h2><ul><li>Idempotenceä»£è¡¨ä¸ç®¡åŸ·è¡Œå¤šå°‘æ¬¡ï¼Œéƒ½å¯ä»¥å¾—åˆ°ç›¸åŒçš„çµæœï¼Œä¸æœƒæœ‰å‰¯ä½œç”¨ã€ä¸æœƒæ”¹è®Šç‹€æ…‹</li><li>HTTP Methodsç•¶ä¸­ï¼Œ<code>GET</code>ã€<code>PUT</code>ã€<code>DELETE</code>æ˜¯å†ªç­‰çš„ï¼Œè€Œ<code>POST</code>å’Œ<code>PATCH</code>ä¸æ˜¯</li><li>ä¾‹å¦‚æ–°å¢ä¸€ç­†äº¤æ˜“(POST)ï¼Œæ‡‰ç”¨å¦‚æœä½¿ç”¨è‡ªå‹•ç”Ÿæˆçš„IDä¾†è¾¨è­˜äº¤æ˜“ï¼Œæ¯ä¸€ç­†äº¤æ˜“çš„IDéƒ½æœƒä¸åŒï¼Œå› æ­¤ä¸æ˜¯å†ªç­‰çš„</li></ul><table><thead><tr><th>æ–¹æ³•</th><th>ç”¨é€”</th><th>æ˜¯å¦ Idempotent</th><th>å¸¸è¦‹ç”¨é€”èªªæ˜</th></tr></thead><tbody><tr><td><strong>GET</strong></td><td>å–å¾—è³‡æº</td><td>âœ… æ˜¯</td><td>æŸ¥è©¢è³‡æ–™ã€è®€å–æ¸…å–®æˆ–å–®ç­†è³‡æ–™</td></tr><tr><td><strong>POST</strong></td><td>å»ºç«‹è³‡æºï¼æäº¤è³‡æ–™</td><td>âŒ å¦</td><td>æ–°å¢è³‡æ–™ï¼ˆå¦‚å»ºç«‹å¸³æˆ¶ã€ä¸‹è¨‚å–®ï¼‰</td></tr><tr><td><strong>DELETE</strong></td><td>åˆªé™¤è³‡æº</td><td>âœ… æ˜¯</td><td>åˆªé™¤ç‰¹å®šè³‡æºï¼ˆå¦‚åˆªé™¤å¸³è™Ÿï¼‰</td></tr><tr><td><strong>PUT</strong></td><td>æ•´ä»½æ›´æ–°ï¼å»ºç«‹è³‡æº</td><td>âœ… æ˜¯</td><td>æ›´æ–°<em>æ•´å€‹è³‡æº</em>å…§å®¹ï¼Œæˆ–ç›´æ¥è¨­å®šè³‡æº</td></tr><tr><td><strong>PATCH</strong></td><td>éƒ¨åˆ†æ›´æ–°è³‡æº</td><td>âŒ å¦ï¼ˆä¸èƒ½ä¿è­‰ï¼‰</td><td>ä¿®æ”¹éƒ¨åˆ†æ¬„ä½ï¼ˆå¦‚æ”¹å¯†ç¢¼ã€åŠ åˆ†ï¼‰</td></tr></tbody></table><ul><li>å†ªç­‰æ€§å½±éŸ¿åˆ°æ˜¯å¦å¯é‡è©¦ï¼šå¦‚æœé€™å€‹è«‹æ±‚å¤±æ•—äº†ï¼ˆä¾‹å¦‚ç¶²è·¯æ–·ç·šã€ä¼ºæœå™¨æ²’å›æ‡‰ï¼‰ï¼Œèƒ½ä¸èƒ½æ”¾å¿ƒåœ°å†ç™¼ä¸€æ¬¡åŒæ¨£çš„è«‹æ±‚ï¼Œè€Œä¸ç”¨æ“”å¿ƒæœƒé€ æˆéŒ¯èª¤æˆ–é‡è¤‡å‰¯ä½œç”¨ï¼Ÿ</li><li>PATCHæ–¹æ³•ç„¡æ³•ä¿è­‰æ¯æ¬¡éƒ½å¯ä»¥ç¬¦åˆå†ªç­‰æ€§</li></ul><h2 id=uri-url-uri-çš„å€åˆ¥>URI, URL, URI çš„å€åˆ¥<a href=#uri-url-uri-çš„å€åˆ¥ class=hanchor arialabel=Anchor>#</a></h2><h3 id=uri-uniform-resource-identifiers>URI (Uniform Resource Identifiers)<a href=#uri-uniform-resource-identifiers class=hanchor arialabel=Anchor>#</a></h3><ul><li>URIçš„åŠŸèƒ½æ˜¯ç”¨æ–¼è­˜åˆ¥webä¸Šçš„è³‡æºï¼Œå¯èƒ½æ˜¯æ–‡ä»¶ã€ç…§ç‰‡&mldr;ç­‰</li><li>ç™¼é€HTTPè«‹æ±‚æ™‚ï¼Œè«‹æ±‚çš„ç›®æ¨™é€šå¸¸æ˜¯ä¸€å€‹URI</li><li>æœ€å¸¸è¦‹çš„ URI é¡å‹æ˜¯ URL</li><li>URI é™¤äº†ç”¨ä¾†å–å¾—è³‡æºï¼ˆä¾‹å¦‚æ‰“é–‹ç¶²é ã€ä¸‹è¼‰åœ–ç‰‡ï¼‰ä¹‹å¤–ï¼Œé‚„å¯ä»¥è§¸ç™¼ä¸åŒçš„è¡Œç‚ºã€‚ä¾‹å¦‚é–‹å•Ÿemailç¨‹å¼ <code>&lt;a href="mailto:someone@example.com">å¯„ä¿¡çµ¦æˆ‘å€‘&lt;/a></code><ul><li>é€™äº› URI é€šå¸¸ç”¨åœ¨ HTML çš„ <code>&lt;a></code> æ¨™ç±¤ä¸­çš„ <code>href</code> å±¬æ€§ï¼Œé€éä½¿ç”¨è€…é»æ“Šé€£çµæ™‚è§¸ç™¼ç‰¹å®šè¡Œç‚º</li></ul></li></ul><h4 id=uri-çš„çµ„æˆæ ¼å¼>URI çš„çµ„æˆæ ¼å¼<a href=#uri-çš„çµ„æˆæ ¼å¼ class=hanchor arialabel=Anchor>#</a></h4><h5 id=schemes>Schemes<a href=#schemes class=hanchor arialabel=Anchor>#</a></h5><ul><li>ä½æ–¼URIçš„æœ€é–‹é ­ï¼ŒæŒ‡å®šç€è¦½å™¨å¿…é ˆä½¿ç”¨å“ªç¨®å”è­°ä¾†ç²å–è³‡æº</li></ul><h5 id=authority>Authority<a href=#authority class=hanchor arialabel=Anchor>#</a></h5><ul><li>ä½æ–¼Schemesçš„å¾Œé¢ï¼ŒPathä¹‹å‰çš„éƒ¨åˆ†</li><li>åŒ…å«ç”¨æˆ¶è³‡è¨Šã€hostå’Œport</li></ul><h5 id=path>Path<a href=#path class=hanchor arialabel=Anchor>#</a></h5><ul><li>ä½æ–¼Authorityä¹‹å¾Œï¼Œè³‡æ–™é€šå¸¸æ˜¯éšå±¤å¼çµ„æˆ(hierarchical form)</li><li>ç›®çš„æ˜¯åœ¨ URI æ‰€å±¬çš„ç¯„åœå…§ï¼Œè­˜åˆ¥å‡ºç‰¹å®šçš„è³‡æº</li></ul><h5 id=query>Query<a href=#query class=hanchor arialabel=Anchor>#</a></h5><ul><li>ä½æ–¼Pathä¹‹å¾Œï¼Œå°è³‡æºé€²ä¸€æ­¥æä¾›æŸ¥è©¢æ¢ä»¶æˆ–åƒæ•¸</li></ul><h5 id=fragment>Fragment<a href=#fragment class=hanchor arialabel=Anchor>#</a></h5><ul><li>URI çš„æœ€å¾Œä¸€éƒ¨åˆ†ï¼Œä»¥ <code>#</code> é–‹é ­</li><li>ç”¨æ–¼æ¨™è­˜è³‡æºä¸­çš„ç‰¹å®šéƒ¨åˆ†ï¼Œä¾‹å¦‚æ–‡æª”çš„å…¶ä¸­ä¸€éƒ¨åˆ†</li></ul><h3 id=url-uniform-resource-locator>URL (Uniform Resource Locator)<a href=#url-uniform-resource-locator class=hanchor arialabel=Anchor>#</a></h3><ul><li>URIçš„å­é›†ï¼Œç”¨æ–¼ç¶²è·¯è³‡æºçš„å®šä½</li><li>URLå’ŒURIå¯ä»¥è¦–ç‚ºæ˜¯ä¸€æ¨£çš„æ±è¥¿ï¼Œæ¨æ£„åš´æ ¼çš„åŠƒåˆ†æ–¹å¼ï¼Œæ•´åˆURIã€URLåŠURN (<a href=https://www.w3.org/TR/uri-clarification/>source</a>)</li></ul><h3 id=urn>URN<a href=#urn class=hanchor arialabel=Anchor>#</a></h3><ul><li>æŒ‡å®šè³‡æºçš„<strong>åç¨±</strong></li></ul><hr><ul><li><a href=https://stackoverflow.com/questions/4913343/what-is-the-difference-between-uri-url-and-urn>What is the difference between URI, URL and URN?</a></li><li><a href=https://developer.mozilla.org/en-US/docs/Web/URI>URIs - MDN Web Docs - Mozilla</a></li><li><a href=https://developer.mozilla.org/en-US/docs/Learn_web_development/Howto/Web_mechanics/What_is_a_URL>What is a URL? - Learn web development | MDN</a></li><li><a href=https://hackmd.io/@CynthiaChuang/URI-URL-and-URN>URIã€URL èˆ‡URN - HackMD</a></li><li><a href=https://hackmd.io/@BrentKao/BJMfdJ2O2>URI è·ŸURLå·®ç•° - HackMD</a></li></ul><hr><h2 id=test-driven-development-tdd>Test Driven Development (TDD)<a href=#test-driven-development-tdd class=hanchor arialabel=Anchor>#</a></h2><blockquote><p>æ’°å¯«æ¸¬è©¦ç¨‹å¼ (æä¾›APIé–‹ç™¼ä¸€å€‹æŒ‡å¼•) â­¢ å¯¦ä½œAPIä»¥ç¬¦åˆæ¸¬è©¦</p></blockquote><ol><li>æ¸¬è©¦åºåˆ—åŒ–èˆ‡ååºåˆ—åŒ–</li><li>æ¸¬è©¦APIçš„æ­£ç¢ºæ€§</li></ol><h3 id=jsontestæ¸¬è©¦åºåˆ—åŒ–èˆ‡ååºåˆ—åŒ–><code>@JsonTest</code>æ¸¬è©¦åºåˆ—åŒ–èˆ‡ååºåˆ—åŒ–<a href=#jsontestæ¸¬è©¦åºåˆ—åŒ–èˆ‡ååºåˆ—åŒ– class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#f92672>package</span> com.springacademy.cashcard;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f92672>import</span> org.assertj.core.util.Arrays;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#f92672>import</span> org.springframework.boot.test.autoconfigure.json.JsonTest;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f92672>import</span> org.springframework.boot.test.json.JacksonTester;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#f92672>import</span> java.io.IOException;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#f92672>import static</span> org.assertj.core.api.Assertions.assertThat;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#a6e22e>@JsonTest</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CashCardJsonTest</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#66d9ef>private</span> JacksonTester<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> json;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#66d9ef>private</span> JacksonTester<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>[]&gt;</span> jsonList;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cashCardSerializationTest</span>() <span style=color:#66d9ef>throws</span> IOException {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>        CashCard cashCard <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CashCard(99L, 123.<span style=color:#a6e22e>45</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>        assertThat(json.<span style=color:#a6e22e>write</span>(cashCard)).<span style=color:#a6e22e>isStrictlyEqualToJson</span>(<span style=color:#e6db74>&#34;expected.json&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        assertThat(json.<span style=color:#a6e22e>write</span>(cashCard)).<span style=color:#a6e22e>hasJsonPathNumberValue</span>(<span style=color:#e6db74>&#34;@.id&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>        assertThat(json.<span style=color:#a6e22e>write</span>(cashCard)).<span style=color:#a6e22e>extractingJsonPathNumberValue</span>(<span style=color:#e6db74>&#34;@.id&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>                .<span style=color:#a6e22e>isEqualTo</span>(99);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>        assertThat(json.<span style=color:#a6e22e>write</span>(cashCard)).<span style=color:#a6e22e>hasJsonPathNumberValue</span>(<span style=color:#e6db74>&#34;@.amount&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>        assertThat(json.<span style=color:#a6e22e>write</span>(cashCard)).<span style=color:#a6e22e>extractingJsonPathNumberValue</span>(<span style=color:#e6db74>&#34;@.amount&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>                .<span style=color:#a6e22e>isEqualTo</span>(123.<span style=color:#a6e22e>45</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cashCardDeserializationTest</span>() <span style=color:#66d9ef>throws</span> IOException {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>        String expected <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#e6db74>           {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#e6db74>               &#34;id&#34;:99,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span><span style=color:#e6db74>               &#34;amount&#34;:123.45
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span><span style=color:#e6db74>           }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span><span style=color:#e6db74>           &#34;&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>        assertThat(json.<span style=color:#a6e22e>parse</span>(expected))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>                .<span style=color:#a6e22e>isEqualTo</span>(<span style=color:#66d9ef>new</span> CashCard(99L, 123.<span style=color:#a6e22e>45</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>        assertThat(json.<span style=color:#a6e22e>parseObject</span>(expected).<span style=color:#a6e22e>id</span>()).<span style=color:#a6e22e>isEqualTo</span>(99);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>        assertThat(json.<span style=color:#a6e22e>parseObject</span>(expected).<span style=color:#a6e22e>amount</span>()).<span style=color:#a6e22e>isEqualTo</span>(123.<span style=color:#a6e22e>45</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>}
</span></span></code></pre></div><p>expected.json:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{  
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>99</span>,  
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;amount&#34;</span>: <span style=color:#ae81ff>123.45</span>  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=get-post-å–®ç­†è³‡æ–™-api>GET, POST å–®ç­†è³‡æ–™ API<a href=#get-post-å–®ç­†è³‡æ–™-api class=hanchor arialabel=Anchor>#</a></h2><ul><li>é€éidç²å–å–®ç­†è³‡è¨Š</li><li>postæ–°å¢ä¸€ç­†æ–°çš„è³‡æ–™</li></ul><h3 id=æ¸¬è©¦ç¨‹å¼>æ¸¬è©¦ç¨‹å¼<a href=#æ¸¬è©¦ç¨‹å¼ class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@SpringBootTest</span>(webEnvironment <span style=color:#f92672>=</span> SpringBootTest.<span style=color:#a6e22e>WebEnvironment</span>.<span style=color:#a6e22e>RANDOM_PORT</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CashCardApplicationTests</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	<span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	TestRestTemplate restTemplate;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldReturnACashCardWhenDataIsSaved</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>		ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate.<span style=color:#a6e22e>getForEntity</span>(<span style=color:#e6db74>&#34;/cashcards/1&#34;</span>, String.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>		assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>OK</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>		DocumentContext documentContext <span style=color:#f92672>=</span> JsonPath.<span style=color:#a6e22e>parse</span>(response.<span style=color:#a6e22e>getBody</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>		Number id <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$.id&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#75715e>//		assertThat(id).isNotNull();</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>		assertThat(id).<span style=color:#a6e22e>isEqualTo</span>(1);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>		Double amount <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$.amount&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>		assertThat(amount).<span style=color:#a6e22e>isEqualTo</span>(123.<span style=color:#a6e22e>45</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>	<span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>	<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldNotReturnACashCardWithAnUnknownId</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>		ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate.<span style=color:#a6e22e>getForEntity</span>(<span style=color:#e6db74>&#34;/cashcards/1000&#34;</span>, String.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>		assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>NOT_FOUND</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>		assertThat(response.<span style=color:#a6e22e>getBody</span>()).<span style=color:#a6e22e>isBlank</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>	<span style=color:#75715e>// æ¸¬è©¦ POST æ–¹æ³•</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>	<span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>	<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldCreateANewCashCard</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>		<span style=color:#75715e>// DB è‡ªå‹•ç”ŸæˆIDï¼Œå› æ­¤é€™è£¡ä¸éœ€è¦æä¾›</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>		CashCard newCashCard <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CashCard(<span style=color:#66d9ef>null</span>, 250.<span style=color:#a6e22e>00</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>		<span style=color:#75715e>// POST ä¹‹å¾Œä¸ç”¨ return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>		ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> createResponse <span style=color:#f92672>=</span> restTemplate.<span style=color:#a6e22e>postForEntity</span>(<span style=color:#e6db74>&#34;/cashcards&#34;</span>, newCashCard, Void.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>		assertThat(createResponse.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>OK</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>}
</span></span></code></pre></div><h3 id=å¯¦ä½œ-api--spring-uricomponentsbuilder-ä»‹ç´¹>å¯¦ä½œ API &ndash; Spring <code>UriComponentsBuilder</code> ä»‹ç´¹<a href=#å¯¦ä½œ-api--spring-uricomponentsbuilder-ä»‹ç´¹ class=hanchor arialabel=Anchor>#</a></h3><ul><li>åœ¨ Web æ‡‰ç”¨ç¨‹å¼ä¸­å‹•æ…‹ç”¢ç”Ÿã€ä¿®æ”¹èˆ‡æ“´å±•ç¶²å€ï¼Œæ¸›å°‘æ‰‹å‹•å­—ä¸²æ‹¼æ¥å¸¶ä¾†çš„éŒ¯èª¤èˆ‡ç¹ç‘£</li></ul><h4 id=ç¯„ä¾‹>ç¯„ä¾‹<a href=#ç¯„ä¾‹ class=hanchor arialabel=Anchor>#</a></h4><ul><li>post API &ndash; æˆåŠŸå¾Œä¸å›å‚³ response body</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@PostMapping</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#66d9ef>private</span> ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>createCashCard</span>(<span style=color:#a6e22e>@RequestBody</span> CashCard newCashCardRequest, UriComponentsBuilder ucb) {  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#75715e>// inject UriComponentsBuilder  </span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    CashCard savedCashCard <span style=color:#f92672>=</span> cashCardRepository.<span style=color:#a6e22e>save</span>(newCashCardRequest); <span style=color:#75715e>// save() returns the saved entity with an ID  </span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    URI locationOfNewCashCard <span style=color:#f92672>=</span> ucb  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>            .<span style=color:#a6e22e>path</span>(<span style=color:#e6db74>&#34;cashcards/{id}&#34;</span>)  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>            .<span style=color:#a6e22e>buildAndExpand</span>(savedCashCard.<span style=color:#a6e22e>id</span>())  <span style=color:#75715e>// åœ¨URIç•¶ä¸­æ’å…¥è®Šæ•¸</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>            .<span style=color:#a6e22e>toUri</span>();  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;New CashCard location: &#34;</span> <span style=color:#f92672>+</span> locationOfNewCashCard);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>created</span>(locationOfNewCashCard).<span style=color:#a6e22e>build</span>();  <span style=color:#75715e>// çµ„è£ä¸¦ç”¢ç”Ÿä¸€å€‹ HTTP å›æ‡‰ç‰©ä»¶ (ResponseEntity)ï¼Œå›å‚³ HTTP 201 Created å›æ‡‰</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>}
</span></span></code></pre></div><ul><li>post API æˆåŠŸå¾Œå›å‚³ response body</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>created</span>(locationOfNewCashCard).<span style=color:#a6e22e>body</span>(...); 
</span></span></code></pre></div><h3 id=å¯¦ä½œ-api--ç¨‹å¼ç¢¼>å¯¦ä½œ API &ndash; ç¨‹å¼ç¢¼<a href=#å¯¦ä½œ-api--ç¨‹å¼ç¢¼ class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#f92672>package</span> com.springacademy.cashcard;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f92672>import</span> org.springframework.http.ResponseEntity;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#f92672>import</span> org.springframework.web.bind.annotation.*;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#f92672>import</span> org.springframework.web.util.UriComponentsBuilder;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f92672>import</span> java.net.URI;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#f92672>import</span> java.util.Optional;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/cashcards&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CashCardController</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> CashCardRepository cashCardRepository;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>CashCardController</span>(CashCardRepository cashCardRepository) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cashCardRepository</span> <span style=color:#f92672>=</span> cashCardRepository;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/{requestedId}&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#66d9ef>private</span> ResponseEntity<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findById</span>(<span style=color:#a6e22e>@PathVariable</span> Long requestedId) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>        Optional<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> cashCardOptional <span style=color:#f92672>=</span> cashCardRepository.<span style=color:#a6e22e>findById</span>(requestedId);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>        <span style=color:#66d9ef>if</span> (cashCardOptional.<span style=color:#a6e22e>isPresent</span>()) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>            <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(cashCardOptional.<span style=color:#a6e22e>get</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>            <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>notFound</span>().<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#75715e>//    @PostMapping</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#75715e>//    private ResponseEntity&lt;Void&gt; createCashCard() {</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#75715e>//        return null; // å¦‚æœreturn nullï¼Œæœƒè‡ªå‹•ç”Ÿæˆ 200 OK statusï¼Œæ¸¬è©¦é€šé</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span><span style=color:#75715e>//    }</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>    <span style=color:#a6e22e>@PostMapping</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    <span style=color:#66d9ef>private</span> ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>createCashCard</span>(<span style=color:#a6e22e>@RequestBody</span> CashCard newCashCardRequest, UriComponentsBuilder ucb) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>        <span style=color:#75715e>// inject UriComponentsBuilder</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>        CashCard savedCashCard <span style=color:#f92672>=</span> cashCardRepository.<span style=color:#a6e22e>save</span>(newCashCardRequest); <span style=color:#75715e>// save() returns the saved entity with an ID</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>        URI locationOfNewCashCard <span style=color:#f92672>=</span> ucb
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>                .<span style=color:#a6e22e>path</span>(<span style=color:#e6db74>&#34;cashcards/{id}&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>                .<span style=color:#a6e22e>buildAndExpand</span>(savedCashCard.<span style=color:#a6e22e>id</span>())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>                .<span style=color:#a6e22e>toUri</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;New CashCard location: &#34;</span> <span style=color:#f92672>+</span> locationOfNewCashCard);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>        <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>created</span>(locationOfNewCashCard).<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>    }}
</span></span></code></pre></div><h2 id=get-åˆ—å‡ºæ‰€æœ‰-cashcards-è³‡æ–™>GET åˆ—å‡ºæ‰€æœ‰ CashCards è³‡æ–™<a href=#get-åˆ—å‡ºæ‰€æœ‰-cashcards-è³‡æ–™ class=hanchor arialabel=Anchor>#</a></h2><h3 id=pagingandsortingrepository-åˆ†é >PagingAndSortingRepository åˆ†é <a href=#pagingandsortingrepository-åˆ†é  class=hanchor arialabel=Anchor>#</a></h3><ul><li>å„ªåŒ–æŸ¥è©¢æ•ˆèƒ½ï¼Œç¸®çŸ­ä½¿ç”¨è€…çš„ç­‰å¾…æ™‚é–“</li><li>æ˜ç¢ºè¨­å®šæ’åºæ–¹å¼ï¼Œä¸å»ºè­°ä½¿ç”¨é è¨­æ’åºï¼Œä»¥å…é€ æˆè³‡æ–™é›£ä»¥ç¶­è­·èˆ‡æ¸¬è©¦</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a6e22e>@GetMapping</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>private</span> ResponseEntity<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>findAll</span>(Pageable pageable) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>   Page<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> page <span style=color:#f92672>=</span> cashCardRepository.<span style=color:#a6e22e>findAll</span>(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>           PageRequest.<span style=color:#a6e22e>of</span>(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>                   pageable.<span style=color:#a6e22e>getPageNumber</span>(),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>                   pageable.<span style=color:#a6e22e>getPageSize</span>(),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>                   pageable.<span style=color:#a6e22e>getSortOr</span>(Sort.<span style=color:#a6e22e>by</span>(Sort.<span style=color:#a6e22e>Direction</span>.<span style=color:#a6e22e>DESC</span>, <span style=color:#e6db74>&#34;amount&#34;</span>))));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>   <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(page.<span style=color:#a6e22e>getContent</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><p>å°æ‡‰çš„ API URL ä¾‹å¦‚: <code>/cashcards?page=1&amp;size=3&amp;sort=amount,desc</code></p><ul><li>Pageable ç‰©ä»¶æœƒè‡ªå‹•è§£æç¶²å€ä¸­çš„ page, size, sort åƒæ•¸</li><li>ç”¨<code>.getContent()</code> ä¾†åªå–å‡ºè³‡æ–™å…§å®¹ï¼Œä¸å›å‚³åˆ†é è³‡è¨Š</li></ul><h4 id=æ›´æ–°-repository-class-ä¾†æ‡‰ç”¨-paging-èˆ‡-sorting>æ›´æ–° Repository class ä¾†æ‡‰ç”¨ paging èˆ‡ sorting<a href=#æ›´æ–°-repository-class-ä¾†æ‡‰ç”¨-paging-èˆ‡-sorting class=hanchor arialabel=Anchor>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#f92672>package</span> com.springacademy.cashcard;  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#f92672>import</span> org.springframework.data.repository.CrudRepository;  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#f92672>import</span> org.springframework.data.repository.PagingAndSortingRepository;  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>CashCardRepository</span> <span style=color:#66d9ef>extends</span> CrudRepository<span style=color:#f92672>&lt;</span>CashCard, Long<span style=color:#f92672>&gt;</span>, PagingAndSortingRepository<span style=color:#f92672>&lt;</span>CashCard, Long<span style=color:#f92672>&gt;</span> {  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div><h4 id=page-ç‰©ä»¶æ ¼å¼ç¯„ä¾‹>Page ç‰©ä»¶æ ¼å¼ç¯„ä¾‹<a href=#page-ç‰©ä»¶æ ¼å¼ç¯„ä¾‹ class=hanchor arialabel=Anchor>#</a></h4><ul><li>content ç•¶ä¸­åŒ…å«å¯¦éš›è³‡æ–™</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JSON data-lang=JSON><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;content&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;amount&#34;</span>: <span style=color:#ae81ff>10.0</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;amount&#34;</span>: <span style=color:#ae81ff>0.19</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;pageable&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;pageNumber&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;pageSize&#34;</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;totalElements&#34;</span>: <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;totalPages&#34;</span>: <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;first&#34;</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;last&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h1 id=part-2-spring-boot-restful-api-çµåˆ-spring-security>Part 2: Spring Boot Restful API çµåˆ Spring Security<a href=#part-2-spring-boot-restful-api-çµåˆ-spring-security class=hanchor arialabel=Anchor>#</a></h1><h2 id=security-è§€å¿µä»‹ç´¹>Security è§€å¿µä»‹ç´¹<a href=#security-è§€å¿µä»‹ç´¹ class=hanchor arialabel=Anchor>#</a></h2><h3 id=same-origin-policy>Same Origin Policy<a href=#same-origin-policy class=hanchor arialabel=Anchor>#</a></h3><ul><li>å¦‚æœå…©å€‹ URL çš„protocol ã€port å’Œ host ç›¸åŒï¼Œå‰‡é€™å…©å€‹ URL å°±æ˜¯ç›¸åŒçš„origin</li><li>SOPæ˜¯ä¸€ç¨®å®‰å…¨æ©Ÿåˆ¶ï¼Œé™åˆ¶åªæœ‰ä¾†è‡ªç›¸åŒä¾†æºçš„è…³æœ¬ç¨‹å¼æ‰èƒ½å‘è©²ä¾†æºç™¼é€è«‹æ±‚</li><li>æœ‰åŠ©æ–¼æ¸›å°‘å¯èƒ½çš„æ”»æ“Šåª’ä»‹ã€‚ä¾‹å¦‚ï¼šé˜²æ­¢æƒ¡æ„ç¶²ç«™åœ¨ä½¿ç”¨è€…çš„ç€è¦½å™¨ä¸­å·å·åŸ·è¡Œ JavaScriptï¼Œå»è®€å–ä½¿ç”¨è€…ç™»å…¥çš„ Webmail æœå‹™è³‡æ–™ï¼Œæˆ–æ˜¯è®€å–ä¸€äº›åªèƒ½åœ¨å…¬å¸å…§éƒ¨ä½¿ç”¨ã€æ²’æœ‰å°å¤–é–‹æ”¾çš„å…§éƒ¨ç¶²ç«™å…§å®¹ï¼Œç„¶å¾Œå†æŠŠé€™äº›è³‡æ–™å·å·å‚³çµ¦æ”»æ“Šè€…</li></ul><hr><ul><li><a href=https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy>Same-origin policy - Security | MDN</a></li></ul><hr><h3 id=cross-origin-resource-sharing-cors>Cross-Origin Resource Sharing (CORS)<a href=#cross-origin-resource-sharing-cors class=hanchor arialabel=Anchor>#</a></h3><ul><li>ç¾åœ¨ç³»çµ±ç¶“å¸¸ç”±å¤šå€‹å¾®æœå‹™æ§‹æˆï¼Œå„è‡ªéƒ¨ç½²åœ¨ä¸åŒçš„ URI ä¸‹ã€‚é€™æ¨£å°±éœ€è¦é€é CORSï¼ˆè·¨ä¾†æºè³‡æºå…±ç”¨ï¼‰ ä¾†è®“ä¸åŒä¾†æºä¹‹é–“çš„è«‹æ±‚è¢«æ¥å—</li><li>Spring Security æä¾› <code>@CrossOrigin</code> è¨»è§£ç”¨ä¾†è¨­å®šè¢«å…è¨±çš„ä¾†æºï¼›ä½†æ˜¯å¦‚æœä½¿ç”¨äº† <code>@CrossOrigin</code> è€ŒæœªæŒ‡å®šä»»ä½•ä¾†æºï¼Œå‰‡é è¨­ç‚ºé–‹æ”¾æ‰€æœ‰ä¾†æºï¼Œæœƒé€ æˆå®‰å…¨é¢¨éšª</li></ul><h3 id=authentication-èªè­‰--authorization-æˆæ¬Š>Authentication (èªè­‰) & Authorization (æˆæ¬Š)<a href=#authentication-èªè­‰--authorization-æˆæ¬Š class=hanchor arialabel=Anchor>#</a></h3><blockquote><p>åœ¨ API çš„ä½¿ç”¨è€…ä¸­ï¼Œå¯èƒ½æ˜¯äººï¼Œä¹Ÿå¯èƒ½æ˜¯å¦ä¸€å€‹ç¨‹å¼ï¼Œå› æ­¤å¸¸ä½¿ç”¨"<strong>Principal</strong>&ldquo;é€™å€‹è©ä¾†ä»£æ›¿"ä½¿ç”¨è€…&rdquo;</p></blockquote><ul><li>èªè­‰æ˜¯è®“ä¸»é«”å‘ç³»çµ±è­‰æ˜è‡ªå·±çš„èº«åˆ†ï¼Œç•¶ä¸»é«”æä¾›äº†æ­£ç¢ºçš„æ†‘è­‰ï¼Œå°±å¯ä»¥ç¨±è©²ä¸»é«”å·²é©—è­‰ï¼ˆAuthenticatedï¼‰</li><li>èªè­‰çš„æ¥ä¸‹ä¾†æ˜¯æˆæ¬Šï¼Œæˆæ¬Šçš„ç›®çš„æ˜¯<strong>å€åˆ†ä¸åŒä½¿ç”¨è€…çš„æ¬Šé™</strong>ï¼Œæ±ºå®šå“ªäº›æ“ä½œæ˜¯è¢«å…è¨±çš„</li></ul><h4 id=authentication-session>Authentication Session<a href=#authentication-session class=hanchor arialabel=Anchor>#</a></h4><ul><li>ç”±æ–¼ HTTP æ˜¯ stateless protocolï¼Œæ¯ä¸€å€‹è«‹æ±‚éƒ½å¿…é ˆè‡ªè¡Œæ”œå¸¶èƒ½è­‰æ˜ä½¿ç”¨è€…èº«åˆ†çš„è³‡è¨Šï¼Œæ•ˆç‡è¼ƒä½ï¼Œå› æ­¤é€™è£¡æ¡ç”¨Authentication Session (åˆå¯ç¨±ä½œ Auth Session, Session) çš„æ–¹å¼</li><li>ä½œæ³•æ˜¯ç”Ÿæˆä¸€çµ„éš¨æ©Ÿå­—ä¸²ä½œç‚º<strong>Session Token</strong>ï¼Œä¸¦å°‡å…¶å„²å­˜åœ¨ç”¨æˆ¶ç«¯çš„ <strong>Cookie</strong> ä¸­</li></ul><h5 id=ä»€éº¼æ˜¯-cookie>ä»€éº¼æ˜¯ Cookie<a href=#ä»€éº¼æ˜¯-cookie class=hanchor arialabel=Anchor>#</a></h5><ul><li>Cookie æ˜¯å„²å­˜åœ¨ç€è¦½å™¨ç«¯çš„ä¸€çµ„è³‡æ–™ï¼Œæœƒè‡ªå‹•éš¨è‘—å°æ‡‰çš„ URI ä¸€èµ·å‚³é€åˆ°ä¼ºæœå™¨</li><li>Cookie çš„å…©å¤§å„ªé»ï¼š<ol><li><strong>è‡ªå‹•éš¨æ¯æ¬¡è«‹æ±‚é€å‡º</strong>ï¼Œä¸éœ€é¡å¤–æ’°å¯«ç¨‹å¼ç¢¼ï¼›</li><li><strong>å…·æœ‰æŒä¹…æ€§</strong>ï¼Œå³ä½¿é—œé–‰ç¶²é å¾Œå†æ¬¡é€ è¨ªä»å¯ç¶­æŒç™»å…¥ç‹€æ…‹ï¼Œæå‡ä½¿ç”¨è€…é«”é©—</li></ol></li></ul><h3 id=role-based-access-controlrbac>Role-Based Access Controlï¼ˆRBACï¼‰<a href=#role-based-access-controlrbac class=hanchor arialabel=Anchor>#</a></h3><ul><li>Spring Security æ¡ç”¨ RBAC ä¾†é€²è¡Œæˆæ¬Šæ§åˆ¶</li><li>æ¯å€‹ä¸»é«”ï¼ˆPrincipalï¼‰éƒ½æ“æœ‰ä¸€çµ„è§’è‰²ï¼ˆRolesï¼‰</li><li>æ¯é …è³‡æºæˆ–æ“ä½œæœƒå®šç¾©å“ªäº›è§’è‰²å¯ä»¥å­˜å–</li><li>RBAC å¯æ‡‰ç”¨åœ¨æ•´é«”æ¶æ§‹ï¼ˆå…¨åŸŸï¼‰æˆ–å–®ä¸€æ–¹æ³•å±¤ç´šä¸Š</li><li>ä¾‹å¦‚ï¼š<ul><li>æ“æœ‰ã€Œç®¡ç†å“¡è§’è‰²ã€çš„ä½¿ç”¨è€…å¯åŸ·è¡Œæ›´å¤šæ“ä½œ</li><li>ã€Œå¡ç‰‡æ“æœ‰è€…è§’è‰²ã€å‰‡é™åˆ¶æ–¼å€‹äººå¡ç‰‡ç®¡ç†</li></ul></li></ul><h3 id=å¸¸è¦‹çš„ç¶²é æ”»æ“Šweb-exploits>å¸¸è¦‹çš„ç¶²é æ”»æ“Šï¼ˆWeb Exploitsï¼‰<a href=#å¸¸è¦‹çš„ç¶²é æ”»æ“Šweb-exploits class=hanchor arialabel=Anchor>#</a></h3><h4 id=è·¨ç«™è«‹æ±‚å½é€ cross-site-request-forgery-csrf>è·¨ç«™è«‹æ±‚å½é€ ï¼ˆCross-Site Request Forgery, CSRFï¼‰<a href=#è·¨ç«™è«‹æ±‚å½é€ cross-site-request-forgery-csrf class=hanchor arialabel=Anchor>#</a></h4><blockquote><p>Spring Security é è¨­å•Ÿç”¨ CSRF ä¿è­·ï¼Œé–‹ç™¼è€…ç„¡é ˆé¡å¤–è¨­å®šå³å¯ä½¿ç”¨</p></blockquote><ul><li>ä½¿ç”¨è€…åœ¨ç™»å…¥ä¸€ç¶²ç«™ä¹‹å¾Œé€ è¨ªå…¶ä»–æƒ¡æ„ç¶²ç«™ï¼Œè®“æƒ¡æ„ç¶²ç«™æœ‰æ©Ÿæœƒå‡å†’ä½¿ç”¨è€…çš„èº«ä»½ä¾†ç™¼é€éæ³•çš„è«‹æ±‚çµ¦å…¶ä»–ç¶²ç«™</li><li>å—å®³ç¶²ç«™ç„¡æ³•è¾¨åˆ¥è«‹æ±‚æ˜¯å¦ç‚ºåˆæ³•æ“ä½œ</li></ul><h4 id=è·¨ç«™è…³æœ¬æ”»æ“Šcross-site-scripting-xss>è·¨ç«™è…³æœ¬æ”»æ“Šï¼ˆCross-Site Scripting, XSSï¼‰<a href=#è·¨ç«™è…³æœ¬æ”»æ“Šcross-site-scripting-xss class=hanchor arialabel=Anchor>#</a></h4><ul><li>å°‡æƒ¡æ„è…³æœ¬æ³¨å…¥åˆ°ç¶²ç«™å…§å®¹ä¸­ï¼Œä½¿å—å®³è€…åœ¨ç€è¦½ç¶²é æ™‚è‡ªå‹•åŸ·è¡Œè©²è…³æœ¬</li></ul><h2 id=gradlebuild-åŠ å…¥-spring-security-dependency>Gradle.build åŠ å…¥ Spring Security dependency<a href=#gradlebuild-åŠ å…¥-spring-security-dependency class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-web&#39;</span>  
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-security&#39;</span>  
</span></span><span style=display:flex><span>    testImplementation <span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-test&#39;</span>  
</span></span><span style=display:flex><span>    testRuntimeOnly <span style=color:#e6db74>&#39;org.junit.platform:junit-platform-launcher&#39;</span>  
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;org.springframework.data:spring-data-jdbc&#39;</span>  
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;com.h2database:h2&#39;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><img src=/blog/images/gradle_image.png alt=alt></p><p>â­¢ Spring Boot é è¨­æœƒé–‹å•Ÿå®‰å…¨æ©Ÿåˆ¶ä¿è­·æ‰€æœ‰ HTTP è·¯å¾‘ï¼ˆ<code>/**</code>ï¼‰ï¼Œå› æ­¤æ‰€æœ‰ API éƒ½éœ€è¦èº«ä»½é©—è­‰ï¼ˆæ¯”å¦‚å¸³è™Ÿå¯†ç¢¼ï¼‰æ‰èƒ½å­˜å–ï¼Œæ‰€æœ‰å—ä¿è­·çš„ endpoint éƒ½æœƒå›å‚³ <code>401 Unauthorized</code></p><h2 id=è¨­ç½®-spring-security>è¨­ç½® Spring Security<a href=#è¨­ç½®-spring-security class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#f92672>package</span> com.springacademy.cashcard;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f92672>import</span> org.springframework.context.annotation.Bean;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#f92672>import</span> org.springframework.context.annotation.Configuration;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#f92672>import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#f92672>import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f92672>import</span> org.springframework.security.crypto.password.PasswordEncoder;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#f92672>import</span> org.springframework.security.web.SecurityFilterChain;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityConfig</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    SecurityFilterChain <span style=color:#a6e22e>filterChain</span>(HttpSecurity http) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        <span style=color:#66d9ef>return</span> http.<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    PasswordEncoder <span style=color:#a6e22e>passwordEncoder</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>}
</span></span></code></pre></div><h3 id=configuration-è¨»è§£>@Configuration è¨»è§£<a href=#configuration-è¨»è§£ class=hanchor arialabel=Anchor>#</a></h3><ul><li>åŠ ä¸Šè¨»è§£çš„classä»£è¡¨è©²classæ˜¯ä¸€å€‹ç”¨ä¾†è¨­å®š Bean çš„é¡åˆ¥</li><li>@Configuration class ç•¶ä¸­å®šç¾©çš„ bean éƒ½æœƒè¢« spring containerè¨»å†Šèµ·ä¾†ï¼Œåœ¨å¾ŒçºŒå°ˆæ¡ˆä¸­ä½¿ç”¨è©²è¨­å®šï¼Œä¸ç„¶æœƒä½¿ç”¨é è¨­çš„è¨­å®š</li></ul><h3 id=bean-è¨»è§£>@Bean è¨»è§£<a href=#bean-è¨»è§£ class=hanchor arialabel=Anchor>#</a></h3><ul><li>ç”¨ä¾†<strong>æ¨™è¨˜æ–¹æ³•</strong>ï¼Œè¡¨ç¤ºé€™å€‹æ–¹æ³•æœƒ<strong>å›å‚³ä¸€å€‹ç‰©ä»¶</strong></li></ul><h2 id=è¨­ç½®åŸºç¤çš„-authentication>è¨­ç½®åŸºç¤çš„ Authentication<a href=#è¨­ç½®åŸºç¤çš„-authentication class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>SecurityFilterChain <span style=color:#a6e22e>filterChain</span>(HttpSecurity http) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	http
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>			.<span style=color:#a6e22e>authorizeHttpRequests</span>(request <span style=color:#f92672>-&gt;</span> request
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>					.<span style=color:#a6e22e>requestMatchers</span>(<span style=color:#e6db74>&#34;/cashcards/**&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>					.<span style=color:#a6e22e>authenticated</span>())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>			.<span style=color:#a6e22e>httpBasic</span>(Customizer.<span style=color:#a6e22e>withDefaults</span>())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>			.<span style=color:#a6e22e>csrf</span>(csrf <span style=color:#f92672>-&gt;</span> csrf.<span style=color:#a6e22e>disable</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	<span style=color:#66d9ef>return</span> http.<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>UserDetailsService <span style=color:#a6e22e>testOnlyUsers</span>(PasswordEncoder passwordEncoder) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	User.<span style=color:#a6e22e>UserBuilder</span> users <span style=color:#f92672>=</span> User.<span style=color:#a6e22e>builder</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	UserDetails sarah <span style=color:#f92672>=</span> users
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>			.<span style=color:#a6e22e>username</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>			.<span style=color:#a6e22e>password</span>(passwordEncoder.<span style=color:#a6e22e>encode</span>(<span style=color:#e6db74>&#34;abc123&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>			.<span style=color:#a6e22e>roles</span>() <span style=color:#75715e>// No roles for now</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>			.<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> InMemoryUserDetailsManager(sarah);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>}
</span></span></code></pre></div><ul><li>å¦‚æœ API æ˜¯çµ¦<em>éç€è¦½å™¨å®¢æˆ¶ç«¯ï¼ˆnon-browser clients</em>ï¼‰ä½¿ç”¨çš„ï¼Œå°±å¯ä»¥é—œé–‰ CSRF ä¿è­·</li><li>æ­¤ç¯„ä¾‹ä¸­æ˜¯å¯¦ä½œ Restful APIï¼Œä¸¦ä¸æ¶‰åŠ cookie/session å¼èº«ä»½é©—è­‰ï¼Œå› æ­¤å¯ä»¥é¸æ“‡é—œé–‰ CSRF ä¿è­·æ©Ÿåˆ¶</li></ul><h3 id=æ¸¬è©¦èªè­‰åŠŸèƒ½>æ¸¬è©¦èªè­‰åŠŸèƒ½<a href=#æ¸¬è©¦èªè­‰åŠŸèƒ½ class=hanchor arialabel=Anchor>#</a></h3><h4 id=test-data-sql>test data (sql)<a href=#test-data-sql class=hanchor arialabel=Anchor>#</a></h4><p>main/resources/schema.sql</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> cash_card  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>(  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>   ID     BIGINT <span style=color:#66d9ef>GENERATED</span> <span style=color:#66d9ef>BY</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>IDENTITY</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>   AMOUNT   NUMBER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>,  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>   <span style=color:#66d9ef>OWNER</span>    VARCHAR(<span style=color:#ae81ff>256</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>);
</span></span></code></pre></div><p>test/resources/data.sql</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> CASH_CARD(ID, AMOUNT, <span style=color:#66d9ef>OWNER</span>) <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>00</span>, <span style=color:#e6db74>&#39;sarah1&#39;</span>);
</span></span></code></pre></div><h4 id=å–®å…ƒæ¸¬è©¦>å–®å…ƒæ¸¬è©¦<a href=#å–®å…ƒæ¸¬è©¦ class=hanchor arialabel=Anchor>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldReturnACashCardWhenDataIsSaved</span>() {  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>          .<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>) <span style=color:#75715e>// update  </span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>          .<span style=color:#a6e22e>getForEntity</span>(<span style=color:#e6db74>&#34;/cashcards/100&#34;</span>, String.<span style=color:#a6e22e>class</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>OK</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    DocumentContext documentContext <span style=color:#f92672>=</span> JsonPath.<span style=color:#a6e22e>parse</span>(response.<span style=color:#a6e22e>getBody</span>());  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    Number id <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$.id&#34;</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    assertThat(id).<span style=color:#a6e22e>isEqualTo</span>(100);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    Double amount <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$.amount&#34;</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    assertThat(amount).<span style=color:#a6e22e>isEqualTo</span>(1.<span style=color:#a6e22e>0</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>}
</span></span></code></pre></div><h2 id=å¯¦ä½œ-rbac>å¯¦ä½œ RBAC<a href=#å¯¦ä½œ-rbac class=hanchor arialabel=Anchor>#</a></h2><ul><li>æ¸¬è©¦ROLESèªè­‰åŠŸèƒ½</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldRejectUsersWhoAreNotCardOwners</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>      .<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;hank-owns-no-cards&#34;</span>, <span style=color:#e6db74>&#34;qrs456&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>      .<span style=color:#a6e22e>getForEntity</span>(<span style=color:#e6db74>&#34;/cashcards/99&#34;</span>, String.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>FORBIDDEN</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div><ul><li>å¢åŠ æ›´å¤šä¸åŒROLES</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>UserDetailsService <span style=color:#a6e22e>testOnlyUsers</span>(PasswordEncoder passwordEncoder) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>  User.<span style=color:#a6e22e>UserBuilder</span> users <span style=color:#f92672>=</span> User.<span style=color:#a6e22e>builder</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>  UserDetails sarah <span style=color:#f92672>=</span> users
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    .<span style=color:#a6e22e>username</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    .<span style=color:#a6e22e>password</span>(passwordEncoder.<span style=color:#a6e22e>encode</span>(<span style=color:#e6db74>&#34;abc123&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    .<span style=color:#a6e22e>roles</span>(<span style=color:#e6db74>&#34;CARD-OWNER&#34;</span>) <span style=color:#75715e>// new role</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>  UserDetails hankOwnsNoCards <span style=color:#f92672>=</span> users
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    .<span style=color:#a6e22e>username</span>(<span style=color:#e6db74>&#34;hank-owns-no-cards&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    .<span style=color:#a6e22e>password</span>(passwordEncoder.<span style=color:#a6e22e>encode</span>(<span style=color:#e6db74>&#34;qrs456&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    .<span style=color:#a6e22e>roles</span>(<span style=color:#e6db74>&#34;NON-OWNER&#34;</span>) <span style=color:#75715e>// new role</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> InMemoryUserDetailsManager(sarah, hankOwnsNoCards);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>}
</span></span></code></pre></div><ul><li>æ›´æ–° FilterChain</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>SecurityFilterChain <span style=color:#a6e22e>filterChain</span>(HttpSecurity http) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>     http
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>             .<span style=color:#a6e22e>authorizeHttpRequests</span>(request <span style=color:#f92672>-&gt;</span> request
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>                     .<span style=color:#a6e22e>requestMatchers</span>(<span style=color:#e6db74>&#34;/cashcards/**&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>                     .<span style=color:#a6e22e>hasRole</span>(<span style=color:#e6db74>&#34;CARD-OWNER&#34;</span>)) <span style=color:#75715e>// enable RBAC: Replace the .authenticated() call with the hasRole(...) call.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>             .<span style=color:#a6e22e>httpBasic</span>(Customizer.<span style=color:#a6e22e>withDefaults</span>())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>             .<span style=color:#a6e22e>csrf</span>(csrf <span style=color:#f92672>-&gt;</span> csrf.<span style=color:#a6e22e>disable</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>     <span style=color:#66d9ef>return</span> http.<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span></code></pre></div><p>â­¢ å•é¡Œï¼šä»»ä½•å·²é©—è­‰ä¸¦æ“æœ‰ <code>CARD-OWNER</code> è§’è‰²çš„ä½¿ç”¨è€…ï¼Œéƒ½å¯ä»¥æŸ¥çœ‹å…¶ä»–äººçš„ CashCards</p><h3 id=æ›´æ–°-cashcardrepository-ä»¥é™åˆ¶æŸ¥è©¢è³‡æ–™ç¯„åœ>æ›´æ–° <code>CashCardRepository</code> ä»¥é™åˆ¶æŸ¥è©¢è³‡æ–™ç¯„åœ<a href=#æ›´æ–°-cashcardrepository-ä»¥é™åˆ¶æŸ¥è©¢è³‡æ–™ç¯„åœ class=hanchor arialabel=Anchor>#</a></h3><blockquote><p>ä¸æ‡‰ä¾è³´æ¡†æ¶å»åšæ‰€æœ‰è³‡æ–™ä¿è­·</p></blockquote><h4 id=æ–°å¢ä¸€åä½¿ç”¨è€…>æ–°å¢ä¸€åä½¿ç”¨è€…<a href=#æ–°å¢ä¸€åä½¿ç”¨è€… class=hanchor arialabel=Anchor>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> CASH_CARD(ID, AMOUNT, <span style=color:#66d9ef>OWNER</span>) <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>102</span>, <span style=color:#ae81ff>200</span>.<span style=color:#ae81ff>00</span>, <span style=color:#e6db74>&#39;kumar2&#39;</span>);
</span></span></code></pre></div><h4 id=æ¸¬è©¦ä¸èƒ½å­˜å–åˆ¥äººçš„è³‡æ–™>æ¸¬è©¦<em>ä¸èƒ½</em>å­˜å–åˆ¥äººçš„è³‡æ–™<a href=#æ¸¬è©¦ä¸èƒ½å­˜å–åˆ¥äººçš„è³‡æ–™ class=hanchor arialabel=Anchor>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldNotAllowAccessToCashCardsTheyDoNotOwn</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>      .<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>      .<span style=color:#a6e22e>getForEntity</span>(<span style=color:#e6db74>&#34;/cashcards/102&#34;</span>, String.<span style=color:#a6e22e>class</span>); <span style=color:#75715e>// kumar2 çš„è³‡æ–™</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>NOT_FOUND</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div><p>error:</p><pre tabindex=0><code>Expected :404 NOT_FOUND
Actual   :200 OK
&lt;Click to see difference&gt;

org.opentest4j.AssertionFailedError: 
expected: 404 NOT_FOUND
 but was: 200 OK
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at com.springacademy.cashcard.CashCardApplicationTests.shouldNotAllowAccessToCashCardsTheyDoNotOwn(CashcardApplicationTests.java:178)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
</code></pre><p>é€éä»¥ä¸‹æ¸¬è©¦å¯ä»¥ç™¼ç¾ï¼Œ<strong>è³‡æ–™æŸ¥è©¢æœªéæ¿¾ OWNERï¼Œçœ‹åˆ°ä¸è©²çœ‹çš„è³‡æ–™</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>	<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldReturnAllCashCardsWhenListIsRequested</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>		ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>				.<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>				.<span style=color:#a6e22e>getForEntity</span>(<span style=color:#e6db74>&#34;/cashcards&#34;</span>, String.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>		assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>OK</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>		DocumentContext documentContext <span style=color:#f92672>=</span> JsonPath.<span style=color:#a6e22e>parse</span>(response.<span style=color:#a6e22e>getBody</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>		<span style=color:#66d9ef>int</span> cashCardCount <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$.length()&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>		assertThat(cashCardCount).<span style=color:#a6e22e>isEqualTo</span>(3);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>	}
</span></span></code></pre></div><h4 id=æ›´æ–°-cashcardrepository-ä¾†éæ¿¾-owner>æ›´æ–° <code>CashCardRepository</code> ä¾†éæ¿¾ owner<a href=#æ›´æ–°-cashcardrepository-ä¾†éæ¿¾-owner class=hanchor arialabel=Anchor>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#f92672>import</span> org.springframework.data.domain.Page;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#f92672>import</span> org.springframework.data.domain.PageRequest;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#f92672>import</span> org.springframework.data.repository.CrudRepository;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#f92672>import</span> org.springframework.data.repository.PagingAndSortingRepository;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>CashCardRepository</span> <span style=color:#66d9ef>extends</span> CrudRepository<span style=color:#f92672>&lt;</span>CashCard, Long<span style=color:#f92672>&gt;</span>, PagingAndSortingRepository<span style=color:#f92672>&lt;</span>CashCard, Long<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>    CashCard <span style=color:#a6e22e>findByIdAndOwner</span>(Long id, String owner);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    Page<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findByOwner</span>(String owner, PageRequest pageRequest);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><h3 id=æ›´æ–°-controller-ä¾†æ‡‰ç”¨éæ¿¾-owner-çš„åŠŸèƒ½>æ›´æ–° Controller ä¾†æ‡‰ç”¨éæ¿¾ owner çš„åŠŸèƒ½<a href=#æ›´æ–°-controller-ä¾†æ‡‰ç”¨éæ¿¾-owner-çš„åŠŸèƒ½ class=hanchor arialabel=Anchor>#</a></h3><p>åœ¨ Spring Security è£¡ï¼Œç•¶ä½¿ç”¨è€…é€šéèº«ä»½é©—è­‰å¾Œï¼Œç³»çµ±æœƒæä¾›ä¸€å€‹ <code>Principal</code> ç‰©ä»¶ä¾†ä»£è¡¨é€™ä½ä½¿ç”¨è€…</p><ul><li><code>Principal</code> åŒ…å«ä½¿ç”¨è€…çš„ç™»å…¥è³‡è¨Š</li><li>å¯ä»¥ä½¿ç”¨ <code>principal.getName()</code> å–å¾—è©²ä½¿ç”¨è€…çš„å¸³è™Ÿåç¨±ï¼ˆBasic Auth å‚³é€²ä¾†çš„ usernameï¼‰</li></ul><p>â­¢ æŠŠ <code>Principal</code> ç•¶ä½œåƒæ•¸åŠ å…¥æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ findByIdAndOwner(&mldr;) ä¾†ç¢ºä¿åªæŸ¥è©¢è©²ä½¿ç”¨è€…è‡ªå·±çš„CashCards</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/{requestedId}&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#66d9ef>private</span> ResponseEntity<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findById</span>(<span style=color:#a6e22e>@PathVariable</span> Long requestedId, Principal principal) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	Optional<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> cashCardOptional <span style=color:#f92672>=</span> Optional.<span style=color:#a6e22e>ofNullable</span>(cashCardRepository.<span style=color:#a6e22e>findByIdAndOwner</span>(requestedId, principal.<span style=color:#a6e22e>getName</span>()));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	<span style=color:#66d9ef>if</span> (cashCardOptional.<span style=color:#a6e22e>isPresent</span>()) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>		<span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(cashCardOptional.<span style=color:#a6e22e>get</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>		<span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>notFound</span>().<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#a6e22e>@GetMapping</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#66d9ef>private</span> ResponseEntity<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>findAll</span>(Pageable pageable, Principal principal) {  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    Page<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> page <span style=color:#f92672>=</span> cashCardRepository.<span style=color:#a6e22e>findByOwner</span>(principal.<span style=color:#a6e22e>getName</span>(),  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>            PageRequest.<span style=color:#a6e22e>of</span>(  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>                    pageable.<span style=color:#a6e22e>getPageNumber</span>(),  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>                    pageable.<span style=color:#a6e22e>getPageSize</span>(),  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>                    pageable.<span style=color:#a6e22e>getSortOr</span>(Sort.<span style=color:#a6e22e>by</span>(Sort.<span style=color:#a6e22e>Direction</span>.<span style=color:#a6e22e>ASC</span>, <span style=color:#e6db74>&#34;amount&#34;</span>))  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>            ));    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(page.<span style=color:#a6e22e>getContent</span>());  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>}
</span></span></code></pre></div><h3 id=æ¸¬è©¦-api>æ¸¬è©¦ API<a href=#æ¸¬è©¦-api class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldReturnAllCashCardsWhenListIsRequested</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#75715e>//		ResponseEntity&lt;String&gt; response = restTemplate.getForEntity(&#34;/cashcards&#34;, String.class);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>			.<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>			.<span style=color:#a6e22e>getForEntity</span>(<span style=color:#e6db74>&#34;/cashcards&#34;</span>, String.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>OK</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	DocumentContext documentContext <span style=color:#f92672>=</span> JsonPath.<span style=color:#a6e22e>parse</span>(response.<span style=color:#a6e22e>getBody</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	<span style=color:#66d9ef>int</span> cashCardCount <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$.length()&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>	assertThat(cashCardCount).<span style=color:#a6e22e>isEqualTo</span>(3);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	JSONArray ids <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$..id&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	assertThat(ids).<span style=color:#a6e22e>containsExactlyInAnyOrder</span>(99, 100, 101);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>	JSONArray amounts <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$..amount&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>	assertThat(amounts).<span style=color:#a6e22e>containsExactlyInAnyOrder</span>(123.<span style=color:#a6e22e>45</span>, 1.<span style=color:#a6e22e>0</span>, 150.<span style=color:#a6e22e>00</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>}
</span></span></code></pre></div><p><img src=/blog/images/pstmn_image.png alt=alt></p><h3 id=æ–°å¢åŠŸèƒ½çš„èªè­‰>æ–°å¢åŠŸèƒ½çš„èªè­‰<a href=#æ–°å¢åŠŸèƒ½çš„èªè­‰ class=hanchor arialabel=Anchor>#</a></h3><ul><li>æ¸¬è©¦ post APIï¼Œä½¿ç”¨ä¸€å€‹æœ‰ç™»å…¥ä½†æ²’æœ‰æ¬Šé™çš„å¸³è™Ÿ</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#a6e22e>@DirtiesContext</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldCreateANewCashCard</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	CashCard newCashCard <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CashCard(<span style=color:#66d9ef>null</span>, 250.<span style=color:#a6e22e>00</span>, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#75715e>//		ResponseEntity&lt;Void&gt; createResponse = restTemplate.postForEntity(&#34;/cashcards&#34;, newCashCard, Void.class);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> createResponse <span style=color:#f92672>=</span> restTemplate.<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>).<span style=color:#a6e22e>postForEntity</span>(<span style=color:#e6db74>&#34;/cashcards&#34;</span>, newCashCard, Void.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	assertThat(createResponse.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>CREATED</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	URI locationOfNewCashCard <span style=color:#f92672>=</span> createResponse.<span style=color:#a6e22e>getHeaders</span>().<span style=color:#a6e22e>getLocation</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> getResponse <span style=color:#f92672>=</span> restTemplate.<span style=color:#a6e22e>getForEntity</span>(locationOfNewCashCard, String.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	assertThat(getResponse.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>OK</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>	DocumentContext documentContext <span style=color:#f92672>=</span> JsonPath.<span style=color:#a6e22e>parse</span>(getResponse.<span style=color:#a6e22e>getBody</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	Number id <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$.id&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	Double amount <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$.amount&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>	assertThat(id).<span style=color:#a6e22e>isNotNull</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>	assertThat(amount).<span style=color:#a6e22e>isEqualTo</span>(250.<span style=color:#a6e22e>00</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>}
</span></span></code></pre></div><p>error:</p><pre tabindex=0><code>org.opentest4j.AssertionFailedError: 
expected: 201 CREATED
 but was: 403 FORBIDDEN
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at com.springacademy.cashcard.CashCardApplicationTests.shouldCreateANewCashCard(CashcardApplicationTests.java:88)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
</code></pre><p>â®• æ›´æ–° Controller</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@PostMapping</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#66d9ef>private</span> ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>createCashCard</span>(<span style=color:#a6e22e>@RequestBody</span> CashCard newCashCardRequest, UriComponentsBuilder ucb, Principal principal) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	CashCard cashCardWithOwner <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CashCard(<span style=color:#66d9ef>null</span>, newCashCardRequest.<span style=color:#a6e22e>amount</span>(), principal.<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	CashCard savedCashCard <span style=color:#f92672>=</span> cashCardRepository.<span style=color:#a6e22e>save</span>(cashCardWithOwner);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	URI locationOfNewCashCard <span style=color:#f92672>=</span> ucb
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>			.<span style=color:#a6e22e>path</span>(<span style=color:#e6db74>&#34;cashcards/{id}&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>			.<span style=color:#a6e22e>buildAndExpand</span>(savedCashCard.<span style=color:#a6e22e>id</span>())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>			.<span style=color:#a6e22e>toUri</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;New CashCard location: &#34;</span> <span style=color:#f92672>+</span> locationOfNewCashCard);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	<span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>created</span>(locationOfNewCashCard).<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>}
</span></span></code></pre></div><hr><ul><li><a href=https://docs.spring.io/spring-security/site/docs/5.2.0.RELEASE/reference/html/index.html>Spring Security Reference docs.spring.io</a></li><li><a href=https://docs.spring.io/spring-security/reference/index.html>Spring Security :: Spring Security</a></li></ul><hr><h2 id=æ›´æ–°è³‡æ–™çš„æ–¹æ³•-post-put-èˆ‡-patch-çš„å·®ç•°>æ›´æ–°è³‡æ–™çš„æ–¹æ³•: POST, PUT èˆ‡ PATCH çš„å·®ç•°<a href=#æ›´æ–°è³‡æ–™çš„æ–¹æ³•-post-put-èˆ‡-patch-çš„å·®ç•° class=hanchor arialabel=Anchor>#</a></h2><table><thead><tr><th>HTTP æ–¹æ³•</th><th>æ“ä½œ</th><th>URI</th><th>åŠŸèƒ½èªªæ˜</th><th>å›å‚³ç‹€æ…‹ç¢¼</th></tr></thead><tbody><tr><td>POST</td><td>å»ºç«‹</td><td><strong>ç”±ä¼ºæœå™¨ç”¢ç”ŸURI</strong>ä¸¦å›å‚³</td><td>å»ºç«‹ä¸€å€‹è³‡æº</td><td>201 CREATED</td></tr><tr><td>PUT</td><td>å»ºç«‹</td><td>å®¢æˆ¶ç«¯æä¾›</td><td>å»ºç«‹ä¸€å€‹è³‡æº</td><td>201 CREATED</td></tr><tr><td>PUT</td><td>æ›´æ–°</td><td>å®¢æˆ¶ç«¯æä¾›</td><td><strong>å®Œæ•´å–ä»£ç¾æœ‰è³‡æ–™</strong></td><td>204 NO CONTENT</td></tr><tr><td>PATCH</td><td>æ›´æ–°</td><td>å®¢æˆ¶ç«¯æä¾›</td><td><strong>éƒ¨åˆ†æ›´æ–°ï¼šåªæ”¹è®Šå‚³å…¥æ¬„ä½</strong></td><td>200 OK</td></tr></tbody></table><ul><li>POST ä¾‹å¦‚å‘¼å« <code>POST /cashcards</code>ï¼Œæœƒå»ºç«‹ä¸€å€‹ <code>/cashcards/101</code> è³‡æº</li><li>PUT ä¾‹å¦‚ <code>PUT /invoice/1234-567</code> æœƒç›´æ¥æ”¾ä¸€å€‹è³‡æºåˆ°é€™å€‹ URI ä¸Š</li></ul><h2 id=put-æ›´æ–°-cashcards-çš„-amounts-è³‡æ–™>PUT æ›´æ–° CashCards çš„ amounts è³‡æ–™<a href=#put-æ›´æ–°-cashcards-çš„-amounts-è³‡æ–™ class=hanchor arialabel=Anchor>#</a></h2><h3 id=æ¸¬è©¦ç¨‹å¼-1>æ¸¬è©¦ç¨‹å¼<a href=#æ¸¬è©¦ç¨‹å¼-1 class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#f92672>import</span> org.springframework.http.HttpEntity;  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#f92672>import</span> org.springframework.http.HttpMethod;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#75715e>// æ¸¬è©¦ PUT æ–¹æ³•  </span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#a6e22e>@DirtiesContext</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldUpdateAnExistingCashCard</span>() {  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    CashCard cashCardUpdate <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CashCard(<span style=color:#66d9ef>null</span>, 19.<span style=color:#a6e22e>99</span>, <span style=color:#66d9ef>null</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#75715e>//æŠŠ CashCard åŒ…è£æˆä¸€å€‹ HTTP è«‹æ±‚å¯¦é«”ï¼ˆåŒ…å«åœ¨ HTTP body ä¸­ï¼‰  </span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    HttpEntity<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> request <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HttpEntity<span style=color:#f92672>&lt;&gt;</span>(cashCardUpdate);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>          .<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>)  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>          .<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>&#34;/cashcards/99&#34;</span>, HttpMethod.<span style=color:#a6e22e>PUT</span>, request, Void.<span style=color:#a6e22e>class</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>NO_CONTENT</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> getResponse <span style=color:#f92672>=</span> restTemplate  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>          .<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>)  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>          .<span style=color:#a6e22e>getForEntity</span>(<span style=color:#e6db74>&#34;/cashcards/99&#34;</span>, String.<span style=color:#a6e22e>class</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    assertThat(getResponse.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>OK</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    DocumentContext documentContext <span style=color:#f92672>=</span> JsonPath.<span style=color:#a6e22e>parse</span>(getResponse.<span style=color:#a6e22e>getBody</span>());  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    Number id <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$.id&#34;</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    Double amount <span style=color:#f92672>=</span> documentContext.<span style=color:#a6e22e>read</span>(<span style=color:#e6db74>&#34;$.amount&#34;</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    assertThat(id).<span style=color:#a6e22e>isEqualTo</span>(99);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    assertThat(amount).<span style=color:#a6e22e>isEqualTo</span>(19.<span style=color:#a6e22e>99</span>);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>}
</span></span></code></pre></div><ul><li>RestTemplate ä¸€èˆ¬çš„ PUT (<code>.put()</code>æ–¹æ³•) æˆåŠŸæ™‚æœƒå›å‚³ 201æˆ–æ˜¯200 responseï¼Œå› æ­¤æ²’æœ‰<code>putForEntity()</code>é€™å€‹æ–¹æ³• => ä½¿ç”¨ <code>exchange()</code> æ–¹æ³•æ›¿ä»£</li><li><code>exhange(URL, HTTPæ–¹æ³•, request HTTPEntity, responseé¡å‹, ...URIè®Šæ•¸)</code> å¯ä»¥åŸ·è¡ŒæŒ‡å®šçš„HTTPæ–¹æ³•ä¸¦å›å‚³ response entity</li></ul><h3 id=æ¸¬è©¦è³‡æ–™>æ¸¬è©¦è³‡æ–™<a href=#æ¸¬è©¦è³‡æ–™ class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> CASH_CARD(ID, AMOUNT, <span style=color:#66d9ef>OWNER</span>) <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>99</span>, <span style=color:#ae81ff>100</span>.<span style=color:#ae81ff>00</span>, <span style=color:#e6db74>&#39;sarah1&#39;</span>);
</span></span></code></pre></div><h3 id=å¯¦ä½œ-api>å¯¦ä½œ API<a href=#å¯¦ä½œ-api class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a6e22e>@PutMapping</span>(<span style=color:#e6db74>&#34;/{requestedId}&#34;</span>)  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>private</span> ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>putCashCard</span>(<span style=color:#a6e22e>@PathVariable</span> Long requestedId, <span style=color:#a6e22e>@RequestBody</span> CashCard cashCardUpdate, Principal principal) {  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    CashCard cashCard <span style=color:#f92672>=</span> cashCardRepository.<span style=color:#a6e22e>findByIdAndOwner</span>(requestedId, principal.<span style=color:#a6e22e>getName</span>());  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    CashCard updatedCashCard <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CashCard(cashCard.<span style=color:#a6e22e>id</span>(), cashCardUpdate.<span style=color:#a6e22e>amount</span>(), principal.<span style=color:#a6e22e>getName</span>());  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    cashCardRepository.<span style=color:#a6e22e>save</span>(updatedCashCard);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>noContent</span>().<span style=color:#a6e22e>build</span>();  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div><p>â­¢ å›å‚³ HTTP ç‹€æ…‹ç¢¼ 204 NO CONTENTï¼Œè¡¨ç¤ºæ›´æ–°æˆåŠŸï¼Œä½†ä¸é™„å¸¶ä»»ä½•å…§å®¹</p><h2 id=æ¸¬è©¦æ›´æ–°ä¸å­˜åœ¨çš„cashcardsè³‡æ–™>æ¸¬è©¦æ›´æ–°ä¸å­˜åœ¨çš„CashCardsè³‡æ–™<a href=#æ¸¬è©¦æ›´æ–°ä¸å­˜åœ¨çš„cashcardsè³‡æ–™ class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldNotUpdateACashCardThatDoesNotExist</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    CashCard unknownCard <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CashCard(<span style=color:#66d9ef>null</span>, 19.<span style=color:#a6e22e>99</span>, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    HttpEntity<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> request <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HttpEntity<span style=color:#f92672>&lt;&gt;</span>(unknownCard);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>            .<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>            .<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>&#34;/cashcards/99999&#34;</span>, HttpMethod.<span style=color:#a6e22e>PUT</span>, request, Void.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>NOT_FOUND</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><p>æ¸¬è©¦ Failedï¼ŒéŒ¯èª¤å¦‚ä¸‹:</p><pre tabindex=0><code>ava.lang.NullPointerException: Cannot invoke &#34;com.springacademy.cashcard.CashCard.id()&#34; because &#34;cashCard&#34; is null
...
org.opentest4j.AssertionFailedError: 
expected: 404 NOT_FOUND
 but was: 403 FORBIDDEN
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at com.springacademy.cashcard.CashCardApplicationTests.shouldNotUpdateACashCardThatDoesNotExist(CashcardApplicationTests.java:238)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
</code></pre><h2 id=è™•ç†-nullpointerexception>è™•ç† <code>NullPointerException</code><a href=#è™•ç†-nullpointerexception class=hanchor arialabel=Anchor>#</a></h2><h3 id=æ›´æ–°-controller-å±¤çš„ç¨‹å¼>æ›´æ–° Controller å±¤çš„ç¨‹å¼<a href=#æ›´æ–°-controller-å±¤çš„ç¨‹å¼ class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@PutMapping</span>(<span style=color:#e6db74>&#34;/{requestedId}&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#66d9ef>private</span> ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>putCashCard</span>(<span style=color:#a6e22e>@PathVariable</span> Long requestedId, <span style=color:#a6e22e>@RequestBody</span> CashCard cashCardUpdate, Principal principal) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    CashCard cashCard <span style=color:#f92672>=</span> cashCardRepository.<span style=color:#a6e22e>findByIdAndOwner</span>(requestedId, principal.<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#66d9ef>if</span> (cashCard <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        CashCard updatedCashCard <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CashCard(cashCard.<span style=color:#a6e22e>id</span>(), cashCardUpdate.<span style=color:#a6e22e>amount</span>(), principal.<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        cashCardRepository.<span style=color:#a6e22e>save</span>(updatedCashCard);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>noContent</span>().<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>notFound</span>().<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span></code></pre></div><h2 id=æ¸¬è©¦æ›´æ–°ä»–äººçš„-cashcards-è³‡æ–™-æœªæˆæ¬Šçš„æƒ…æ³>æ¸¬è©¦æ›´æ–°ä»–äººçš„ CashCards è³‡æ–™ (æœªæˆæ¬Šçš„æƒ…æ³)<a href=#æ¸¬è©¦æ›´æ–°ä»–äººçš„-cashcards-è³‡æ–™-æœªæˆæ¬Šçš„æƒ…æ³ class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldNotUpdateACashCardThatIsOwnedBySomeoneElse</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    CashCard kumarsCard <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CashCard(<span style=color:#66d9ef>null</span>, 333.<span style=color:#a6e22e>33</span>, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    HttpEntity<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> request <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HttpEntity<span style=color:#f92672>&lt;&gt;</span>(kumarsCard);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>            .<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>            .<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>&#34;/cashcards/102&#34;</span>, HttpMethod.<span style=color:#a6e22e>PUT</span>, request, Void.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>NOT_FOUND</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><h2 id=åŸ·è¡Œ-delete-æ–¹æ³•å¾Œå¯èƒ½çš„-response>åŸ·è¡Œ DELETE æ–¹æ³•å¾Œå¯èƒ½çš„ response<a href=#åŸ·è¡Œ-delete-æ–¹æ³•å¾Œå¯èƒ½çš„-response class=hanchor arialabel=Anchor>#</a></h2><table><thead><tr><th>å›æ‡‰ç¢¼</th><th>ä½¿ç”¨æƒ…å¢ƒ</th></tr></thead><tbody><tr><td><code>204 NO CONTENT</code></td><td>è©²ç´€éŒ„å­˜åœ¨ï½œä½¿ç”¨è€…ï¼ˆPrincipalï¼‰æœ‰æˆæ¬Šï½œç´€éŒ„æˆåŠŸè¢«åˆªé™¤</td></tr><tr><td><code>404 NOT FOUND</code></td><td>è©²ç´€éŒ„ä¸å­˜åœ¨ï¼ˆä¹Ÿå°±æ˜¯é€äº†ä¸€å€‹ä¸å­˜åœ¨çš„ IDï¼‰ã€‚</td></tr><tr><td><code>404 NOT FOUND</code></td><td>ç´€éŒ„å­˜åœ¨ï¼Œä½†ä½¿ç”¨è€…ä¸¦ä¸æ˜¯è©²ç´€éŒ„çš„æ“æœ‰è€…ï¼Œæ²’æœ‰åˆªé™¤æ¬Šé™ã€‚</td></tr></tbody></table><ul><li>æ²’æœ‰æ¬Šé™åˆªé™¤æœƒé¡¯ç¤º404errorçš„åŸå› æ˜¯ç‚ºäº†é¿å…æ´©æ¼è³‡è¨Šï¼Œå¦‚æœè¨˜éŒ„ç°¿å­˜åœ¨å’Œç„¡æ¬Šé™åˆªé™¤å…©å€‹æƒ…æ³å›æ‡‰ç¢¼ä¸åŒï¼Œæƒ¡æ„çš„ä½¿ç”¨è€…å¯ä»¥è—‰æ­¤çŒœå‡ºå“ªäº›è³‡æ–™å­˜åœ¨ï¼Œé€²è€ŒçŒœæ¸¬è³‡æ–™åº«çµæ§‹æˆ–è³‡æ–™å…§å®¹</li></ul><h2 id=hard-delete-vs-soft-delete>Hard Delete v.s. Soft Delete<a href=#hard-delete-vs-soft-delete class=hanchor arialabel=Anchor>#</a></h2><h3 id=hard-delete>Hard Delete<a href=#hard-delete class=hanchor arialabel=Anchor>#</a></h3><ul><li>ç›´æ¥åˆªé™¤DBç•¶ä¸­çš„è³‡æ–™ï¼Œç„¡æ³•å¾©åŸ</li><li>æ—¥å¾Œéœ€è¦é‚£ç­†è³‡æ–™çš„è©±å°±æœƒæ‰¾ä¸åˆ°</li></ul><p>â­¢ åˆªé™¤æˆåŠŸå¾Œçš„response å¯èƒ½æ˜¯ <code>204 NO CONTENT</code></p><h3 id=soft-delete>Soft Delete<a href=#soft-delete class=hanchor arialabel=Anchor>#</a></h3><ul><li>ä¸¦æ²’æœ‰çœŸæ­£çš„åˆªé™¤è³‡æ–™ï¼Œè€Œæ˜¯åŠ ä¸Šä¸€å€‹ã€Œå·²åˆªé™¤ã€çš„æ¨™è¨˜</li><li>ä¾‹å¦‚åŠ ä¸Š IS_DELETEæ¬„ä½å­˜æ”¾ booleanï¼Œæˆ–æ˜¯åŠ ä¸Š DELETED_DATE Timestamp</li></ul><p>â­¢ åˆªé™¤æˆåŠŸå¾Œçš„response å¯èƒ½æ˜¯ <code>200 OK</code></p><h2 id=ç¨½æ ¸ç´€éŒ„audit-trailèˆ‡æ­¸æª”archiving>ç¨½æ ¸ç´€éŒ„ï¼ˆAudit Trailï¼‰èˆ‡æ­¸æª”ï¼ˆArchivingï¼‰<a href=#ç¨½æ ¸ç´€éŒ„audit-trailèˆ‡æ­¸æª”archiving class=hanchor arialabel=Anchor>#</a></h2><p>åœ¨å¯¦éš›ä½¿ç”¨è³‡æ–™åº«æ™‚ï¼Œç¶“å¸¸æœƒæœ‰éœ€æ±‚è¦ä¿ç•™è³‡æ–™çš„è®Šæ›´ç´€éŒ„ã€‚ä¾‹å¦‚ï¼š</p><ul><li>å®¢æœå¯èƒ½éœ€è¦çŸ¥é“ä½¿ç”¨è€…ä»€éº¼æ™‚å€™åˆªé™¤äº†æŸå¼µ Cash Cardã€‚</li><li>æœ‰äº›æ³•å¾‹è¦ç¯„è¦æ±‚ï¼Œåˆªé™¤çš„è³‡æ–™å¿…é ˆä¿ç•™ä¸€æ®µæ™‚é–“ã€‚
å¦‚æœæ¡ç”¨ç¡¬åˆªé™¤ï¼Œé‚£æˆ‘å€‘å°±éœ€è¦é¡å¤–å„²å­˜é€™äº›è³‡è¨Šã€‚ä»¥ä¸‹æ˜¯å¸¸è¦‹åšæ³•ï¼š</li></ul><ol><li><strong>æ­¸æª”ï¼ˆArchiveï¼‰</strong>ï¼š<br>å°‡åˆªé™¤çš„è³‡æ–™æ¬åˆ°å¦ä¸€å€‹ä½ç½®ï¼ˆè³‡æ–™è¡¨æˆ–è³‡æ–™åº«ï¼‰ã€‚</li><li><strong>åŠ å…¥ç¨½æ ¸æ¬„ä½ï¼ˆAudit Fieldsï¼‰</strong>ï¼Œä¾‹å¦‚ï¼š<ul><li><code>DELETED_DATE</code>ï¼šåˆªé™¤çš„æ™‚é–“</li><li><code>DELETED_BY_USER</code>ï¼šèª°åˆªçš„</li><li><em>ä¹Ÿå¯ä»¥ç”¨åœ¨æ–°å¢å’Œæ›´æ–°ä¸Š</em></li></ul></li><li><strong>ç¨½æ ¸ç´€éŒ„ï¼ˆAudit Trailï¼‰</strong>ï¼šä¿å­˜æ¯ä¸€ç­†æ“ä½œçš„å®Œæ•´è¨˜éŒ„ï¼ˆä¸åªæ˜¯æœ€è¿‘ä¸€æ¬¡ï¼‰ã€‚é€™äº›ç´€éŒ„å¯ä»¥å­˜åœ¨å¦ä¸€å€‹è³‡æ–™è¡¨ï¼Œæˆ–æ˜¯æˆ–æ—¥èªŒæª”æ¡ˆï¼ˆlog fileï¼‰</li></ol><h2 id=delete-åˆªé™¤å–®ç­†-cashcards-è³‡æ–™>DELETE åˆªé™¤å–®ç­† CashCards è³‡æ–™<a href=#delete-åˆªé™¤å–®ç­†-cashcards-è³‡æ–™ class=hanchor arialabel=Anchor>#</a></h2><h3 id=æ¸¬è©¦ç¨‹å¼-2>æ¸¬è©¦ç¨‹å¼<a href=#æ¸¬è©¦ç¨‹å¼-2 class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#a6e22e>@DirtiesContext</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldDeleteAnExistingCashCard</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>            .<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>            .<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>&#34;/cashcards/99&#34;</span>, HttpMethod.<span style=color:#a6e22e>DELETE</span>, <span style=color:#66d9ef>null</span>, Void.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>NO_CONTENT</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> getResponse <span style=color:#f92672>=</span> restTemplate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	            .<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	            .<span style=color:#a6e22e>getForEntity</span>(<span style=color:#e6db74>&#34;/cashcards/99&#34;</span>, String.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    assertThat(getResponse.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>NOT_FOUND</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>}
</span></span></code></pre></div><h3 id=å¯¦ä½œ-api-1>å¯¦ä½œ API<a href=#å¯¦ä½œ-api-1 class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a6e22e>@DeleteMapping</span>(<span style=color:#e6db74>&#34;/{id}&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>private</span> ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>deleteCashCard</span>(<span style=color:#a6e22e>@PathVariable</span> Long id) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    cashCardRepository.<span style=color:#a6e22e>deleteById</span>(id); <span style=color:#75715e>// Add this line</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>noContent</span>().<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>}
</span></span></code></pre></div><h2 id=æ¸¬è©¦åˆªé™¤ä¸å­˜åœ¨çš„-cashcards-è³‡æ–™>æ¸¬è©¦åˆªé™¤ä¸å­˜åœ¨çš„ CashCards è³‡æ–™<a href=#æ¸¬è©¦åˆªé™¤ä¸å­˜åœ¨çš„-cashcards-è³‡æ–™ class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldNotDeleteACashCardThatDoesNotExist</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> deleteResponse <span style=color:#f92672>=</span> restTemplate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>            .<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>            .<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>&#34;/cashcards/99999&#34;</span>, HttpMethod.<span style=color:#a6e22e>DELETE</span>, <span style=color:#66d9ef>null</span>, Void.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    assertThat(deleteResponse.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>NOT_FOUND</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div><p>æ¸¬è©¦ Failedï¼ŒéŒ¯èª¤å¦‚ä¸‹:</p><pre tabindex=0><code>Expected :404 NOT_FOUND
Actual   :204 NO_CONTENT
&lt;Click to see difference&gt;

org.opentest4j.AssertionFailedError: 
expected: 404 NOT_FOUND
 but was: 204 NO_CONTENT
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at com.springacademy.cashcard.CashCardApplicationTests.shouldNotDeleteACashCardThatDoesNotExist(CashcardApplicationTests.java:271)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
</code></pre><p>â®• æ²’æœ‰è™•ç†ã€Œè³‡æ–™ä¸å­˜åœ¨ã€çš„æƒ…æ³
â®• å‘¼å« Spring Data JPA çš„ deleteById() æ–¹æ³•ï¼Œå¦‚æœIDä¸å­˜åœ¨ï¼Œä¸æœƒä¸Ÿå‡ºä¾‹å¤–ï¼Œä¹Ÿä¸æœƒæ‹‹éŒ¯</p><h3 id=æ›´æ–°-controller-å±¤ç¨‹å¼>æ›´æ–° Controller å±¤ç¨‹å¼<a href=#æ›´æ–°-controller-å±¤ç¨‹å¼ class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a6e22e>@DeleteMapping</span>(<span style=color:#e6db74>&#34;/{id}&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#66d9ef>private</span> ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>deleteCashCard</span>(<span style=color:#a6e22e>@PathVariable</span> Long id, Principal principal) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#75715e>//        cashCardRepository.deleteById(id); // Add this line</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>cashCardRepository.<span style=color:#a6e22e>existsByIdAndOwner</span>(id, principal.<span style=color:#a6e22e>getName</span>())) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>            <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>notFound</span>().<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>        <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>noContent</span>().<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    }
</span></span></code></pre></div><h3 id=æ›´æ–°-repository-å±¤ç¨‹å¼>æ›´æ–° Repository å±¤ç¨‹å¼<a href=#æ›´æ–°-repository-å±¤ç¨‹å¼ class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#f92672>package</span> com.springacademy.cashcard;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f92672>import</span> org.springframework.data.domain.Page;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#f92672>import</span> org.springframework.data.domain.PageRequest;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#f92672>import</span> org.springframework.data.repository.CrudRepository;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#f92672>import</span> org.springframework.data.repository.PagingAndSortingRepository;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>CashCardRepository</span> <span style=color:#66d9ef>extends</span> CrudRepository<span style=color:#f92672>&lt;</span>CashCard, Long<span style=color:#f92672>&gt;</span>, PagingAndSortingRepository<span style=color:#f92672>&lt;</span>CashCard, Long<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    CashCard <span style=color:#a6e22e>findByIdAndOwner</span>(Long id, String owner);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    Page<span style=color:#f92672>&lt;</span>CashCard<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findByOwner</span>(String owner, PageRequest pageRequest);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>existsByIdAndOwner</span>(Long id, String owner);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>}
</span></span></code></pre></div><h2 id=æ¸¬è©¦åˆªé™¤æœªæˆæ¬Šå­˜å–çš„-cashcards-è³‡æ–™>æ¸¬è©¦åˆªé™¤æœªæˆæ¬Šå­˜å–çš„ CashCards è³‡æ–™<a href=#æ¸¬è©¦åˆªé™¤æœªæˆæ¬Šå­˜å–çš„-cashcards-è³‡æ–™ class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldNotAllowDeletionOfCashCardsTheyDoNotOwn</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    ResponseEntity<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> deleteResponse <span style=color:#f92672>=</span> restTemplate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>            .<span style=color:#a6e22e>withBasicAuth</span>(<span style=color:#e6db74>&#34;sarah1&#34;</span>, <span style=color:#e6db74>&#34;abc123&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>            .<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>&#34;/cashcards/102&#34;</span>, HttpMethod.<span style=color:#a6e22e>DELETE</span>, <span style=color:#66d9ef>null</span>, Void.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    assertThat(deleteResponse.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>NOT_FOUND</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><a href=https://kinako890419.github.io/blog/posts/hello-terminal/ class="button inline prev">&lt; [<span class=button__text>è‡ªæˆ‘ä»‹ç´¹</span>]
</a>::
<a href=https://kinako890419.github.io/blog/posts/2025-plurk-hotwater-bot/ class="button inline next">[<span class=button__text>å¤šå–ç†±æ°´2.0</span>] ></a></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/blog/bundle.min.js></script></div></body></html>